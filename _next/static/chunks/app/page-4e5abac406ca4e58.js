(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4016:function(e,s,t){Promise.resolve().then(t.bind(t,7264))},7264:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(7437),l=t(2265);function i(){let[e,s]=(0,l.useState)(155),[t,i]=(0,l.useState)("15:30");return(0,l.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/exchange-rates"),t=await e.json();t.rate&&s(t.rate)}catch(e){console.error("為替レート取得エラー:",e)}};e();let t=setInterval(e,36e5);return()=>clearInterval(t)},[]),(0,l.useEffect)(()=>{let e=()=>{i(new Date().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}))};e();let s=setInterval(e,6e4);return()=>clearInterval(s)},[]),(0,a.jsx)("header",{className:"header",children:(0,a.jsxs)("div",{className:"header-content",children:[(0,a.jsx)("div",{className:"logo",children:"\uD83D\uDCCA StockX Arbitrage Monitor"}),(0,a.jsxs)("div",{className:"header-info",children:[(0,a.jsxs)("div",{className:"exchange-rate",children:["\uD83D\uDCB1 1 USD = \xa5",e.toFixed(2)]}),(0,a.jsxs)("div",{className:"update-status",children:[(0,a.jsx)("span",{className:"status-dot"}),(0,a.jsxs)("span",{children:["最終更新: ",t]})]})]})]})})}function c(){let[e,s]=(0,l.useState)({totalProducts:248,profitableProducts:37,avgProfitRate:18.5,maxProfit:8750,maxProfitProduct:"Dunk Low Chicago",changes:{totalProducts:12,profitableProducts:5,avgProfitRate:-2.3}});return(0,l.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/stats"),t=await e.json();s(t)}catch(e){console.error("統計データ取得エラー:",e)}};e();let t=setInterval(e,18e5);return()=>clearInterval(t)},[]),(0,a.jsxs)("div",{className:"stats-container",children:[(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-title",children:"監視中の商品"}),(0,a.jsx)("div",{className:"stat-value",children:e.totalProducts.toLocaleString()}),(0,a.jsxs)("div",{className:"stat-change ".concat(e.changes.totalProducts>=0?"positive":"negative"),children:[e.changes.totalProducts>=0?"+":"",e.changes.totalProducts," 本日追加"]})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-title",children:"利益可能商品"}),(0,a.jsx)("div",{className:"stat-value",children:e.profitableProducts}),(0,a.jsxs)("div",{className:"stat-change ".concat(e.changes.profitableProducts>=0?"positive":"negative"),children:[e.changes.profitableProducts>=0?"+":"",e.changes.profitableProducts," 前日比"]})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-title",children:"平均利益率"}),(0,a.jsxs)("div",{className:"stat-value",children:[e.avgProfitRate,"%"]}),(0,a.jsxs)("div",{className:"stat-change ".concat(e.changes.avgProfitRate>=0?"positive":"negative"),children:[e.changes.avgProfitRate>=0?"+":"",e.changes.avgProfitRate,"%"]})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-title",children:"最高利益商品"}),(0,a.jsxs)("div",{className:"stat-value",children:["\xa5",e.maxProfit.toLocaleString()]}),(0,a.jsx)("div",{className:"stat-change",children:e.maxProfitProduct})]})]})}function r(e){let{onFilterChange:s,onRefresh:t}=e,[i,c]=(0,l.useState)({brand:"all",category:"all",minProfit:1e3,size:"all",popularOnly:!0,inStockOnly:!1}),r=(e,t)=>{let a={...i,[e]:t};c(a),s(a)};return(0,a.jsx)("div",{className:"controls",children:(0,a.jsxs)("div",{className:"filter-row",children:[(0,a.jsxs)("div",{className:"filter-group",children:[(0,a.jsx)("label",{className:"filter-label",children:"ブランド"}),(0,a.jsxs)("select",{className:"filter-select",value:i.brand,onChange:e=>r("brand",e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"nike",children:"Nike"}),(0,a.jsx)("option",{value:"adidas",children:"Adidas"})]})]}),(0,a.jsxs)("div",{className:"filter-group",children:[(0,a.jsx)("label",{className:"filter-label",children:"カテゴリ"}),(0,a.jsxs)("select",{className:"filter-select",value:i.category,onChange:e=>r("category",e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"sneakers",children:"スニーカー"}),(0,a.jsx)("option",{value:"sandals",children:"サンダル"})]})]}),(0,a.jsxs)("div",{className:"filter-group",children:[(0,a.jsx)("label",{className:"filter-label",children:"最低利益"}),(0,a.jsx)("input",{type:"number",className:"filter-input",placeholder:"\xa51,000",value:i.minProfit,onChange:e=>r("minProfit",parseInt(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"filter-group",children:[(0,a.jsx)("label",{className:"filter-label",children:"サイズ"}),(0,a.jsxs)("select",{className:"filter-select",value:i.size,onChange:e=>r("size",e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"small",children:"US 4-7"}),(0,a.jsx)("option",{value:"regular",children:"US 8-11"}),(0,a.jsx)("option",{value:"large",children:"US 12+"})]})]}),(0,a.jsxs)("div",{className:"filter-group",children:[(0,a.jsx)("label",{className:"filter-label",children:"表示オプション"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,a.jsx)("div",{className:"filter-checkbox ".concat(i.popularOnly?"active":""),onClick:()=>r("popularOnly",!i.popularOnly),children:"人気商品のみ"}),(0,a.jsx)("div",{className:"filter-checkbox ".concat(i.inStockOnly?"active":""),onClick:()=>r("inStockOnly",!i.inStockOnly),children:"在庫ありのみ"})]})]}),(0,a.jsx)("button",{className:"btn-refresh",onClick:()=>{t()},children:"\uD83D\uDD04 更新"})]})})}function n(e){var s,t,i,c,r,n,o;let{product:d}=e,[h,u]=(0,l.useState)(!1),x=d.price_history&&d.price_history.length>0?d.price_history[0]:null,j=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"JPY";return e?"USD"===s?"$".concat(e):"\xa5".concat(e.toLocaleString()):"-"};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"product-cell",children:[(0,a.jsx)("div",{className:"product-image",children:d.image_url?(0,a.jsx)("img",{src:d.image_url,alt:d.name}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs",children:"IMG"})}),(0,a.jsxs)("div",{className:"product-info",children:[(0,a.jsx)("div",{className:"product-name",children:d.name}),(0,a.jsx)("div",{className:"product-sku",children:d.sku}),(0,a.jsx)("div",{className:"product-brand",children:d.brand})]})]})}),(0,a.jsx)("td",{className:"price-cell",children:x?(0,a.jsxs)(a.Fragment,{children:[j(147.68*x.stockx_lowest_ask,"JPY"),(0,a.jsx)("div",{className:"price-usd",children:j(x.stockx_lowest_ask,"USD")})]}):"-"}),(0,a.jsx)("td",{className:"price-cell",children:x?(0,a.jsxs)(a.Fragment,{children:[j(x.japan_lowest_price),(0,a.jsx)("div",{className:"price-source",children:x.japan_lowest_source||"N/A"})]}):"-"}),(0,a.jsx)("td",{className:"price-cell",children:x&&x.stockx_lowest_ask&&x.japan_lowest_price?(0,a.jsxs)("span",{className:"profit-positive",children:["+\xa5",(147.68*x.stockx_lowest_ask-x.japan_lowest_price).toLocaleString()]}):"-"}),(0,a.jsx)("td",{children:x?(0,a.jsxs)("div",{className:"expense-details",children:["手数料: \xa5",(null===(s=x.stockx_fee)||void 0===s?void 0:s.toLocaleString())||"N/A",(0,a.jsx)("br",{}),"関税: \xa5",(null===(t=x.customs_duty)||void 0===t?void 0:t.toLocaleString())||"N/A",(0,a.jsx)("br",{}),"国内送料: \xa5",(null===(i=x.domestic_shipping)||void 0===i?void 0:i.toLocaleString())||"N/A",(0,a.jsx)("br",{}),(0,a.jsxs)("strong",{children:["合計: \xa5",null===(c=(x.stockx_fee||0)+(x.customs_duty||0)+(x.domestic_shipping||0))||void 0===c?void 0:c.toLocaleString()]})]}):"-"}),(0,a.jsx)("td",{className:"profit-cell",children:x?(0,a.jsxs)(a.Fragment,{children:[(e=>{if(!e)return"-";let s=e>0;return(0,a.jsxs)("span",{className:s?"profit-positive":"profit-negative",children:[s?"+":"","\xa5",e.toLocaleString()]})})(x.net_profit),(0,a.jsxs)("div",{className:"profit-rate",children:["利益率: ",(null===(r=x.profit_rate)||void 0===r?void 0:r.toFixed(1))||"N/A","%"]})]}):"-"}),(0,a.jsx)("td",{children:(o=d.popularity_rank||999)<=3?(0,a.jsxs)("span",{className:"popularity-badge hot",children:["#",o," \uD83D\uDD25"]}):(0,a.jsxs)("span",{className:"popularity-badge",children:["#",o]})}),(0,a.jsx)("td",{className:"action-cell",children:x&&x.net_profit>0?(0,a.jsx)("button",{className:"btn-buy",onClick:()=>{var e;confirm("".concat(d.name,"を購入しますか？\n予想利益: \xa5").concat((null==x?void 0:null===(e=x.net_profit)||void 0===e?void 0:e.toLocaleString())||"N/A"))&&alert("購入ページへ遷移します（実装予定）")},children:"購入"}):(0,a.jsx)("button",{className:"btn-detail",onClick:()=>{u(!h)},children:"詳細"})})]}),h&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"8",className:"bg-gray-50 p-4",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"詳細情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"最終更新:"})," ",x?new Date(x.recorded_at).toLocaleString("ja-JP"):"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"為替レート:"})," ",(null==x?void 0:x.exchange_rate)||"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"StockX URL:"})," ",(0,a.jsxs)("a",{href:"https://stockx.com/".concat(d.sku),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["https://stockx.com/",d.sku]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"価格詳細:"})}),(0,a.jsxs)("ul",{className:"text-xs text-gray-600 ml-2",children:[(0,a.jsxs)("li",{children:["StockX最低売値: $",(null==x?void 0:x.stockx_lowest_ask)||"N/A"]}),(0,a.jsxs)("li",{children:["StockX最高買値: $",(null==x?void 0:x.stockx_highest_bid)||"N/A"]}),(0,a.jsxs)("li",{children:["StockX最終売値: $",(null==x?void 0:x.stockx_last_sale)||"N/A"]}),(0,a.jsxs)("li",{children:["日本最安値: \xa5",(null==x?void 0:null===(n=x.japan_lowest_price)||void 0===n?void 0:n.toLocaleString())||"N/A"]})]})]})]})]})})})]})}function o(e){let{filters:s}=e,[t,i]=(0,l.useState)([]),[c,r]=(0,l.useState)(!0),[o,d]=(0,l.useState)("popularity"),[h,u]=(0,l.useState)(null);(0,l.useEffect)(()=>{x();let e=setInterval(()=>{console.log("自動更新中..."),x()},3e4);return()=>clearInterval(e)},[s,o]);let x=async()=>{r(!0);try{let e=new URLSearchParams({...s,sortBy:o,limit:100}),t=await fetch("/api/products?".concat(e)),a=await t.json();i(a),u(new Date)}catch(e){console.error("商品データ取得エラー:",e)}finally{r(!1)}},j=e=>[["商品名","SKU","サイズ","ブランド","カテゴリ","StockX価格(USD)","StockX価格(JPY)","日本最安値","日本サイト","差額","手数料","関税","国内送料","予想利益","利益率","人気度"],...e.map(e=>[e.name,e.sku,e.size_us,e.brand,e.category,e.stockx_price_usd,e.stockx_price_jpy,e.japan_lowest_price,e.japan_lowest_source,e.price_difference,e.stockx_fee,e.customs_duty,e.domestic_shipping,e.net_profit,e.profit_rate,e.popularity_rank])].map(e=>e.join(",")).join("\n");return c?(0,a.jsxs)("div",{className:"table-container",children:[(0,a.jsx)("div",{className:"table-header",children:(0,a.jsx)("h2",{className:"table-title",children:"価格比較リスト"})}),(0,a.jsxs)("div",{className:"loading",children:[(0,a.jsx)("div",{className:"spinner"}),(0,a.jsx)("p",{children:"データを読み込み中..."})]})]}):(0,a.jsxs)("div",{className:"table-container",children:[(0,a.jsxs)("div",{className:"table-header",children:[(0,a.jsx)("h2",{className:"table-title",children:"価格比較リスト"}),(0,a.jsxs)("div",{className:"table-controls",children:[h&&(0,a.jsxs)("div",{className:"last-update",children:["最終更新: ",h.toLocaleString("ja-JP")]}),(0,a.jsx)("button",{className:"export-btn",onClick:()=>{let e=new Blob([j(t)],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),a=URL.createObjectURL(e);s.setAttribute("href",a),s.setAttribute("download","stockx_arbitrage_".concat(new Date().toISOString().split("T")[0],".csv")),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:"CSVエクスポート"})]})]}),(0,a.jsx)("div",{className:"data-table",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{style:{width:"25%"},children:"商品情報"}),(0,a.jsx)("th",{style:{width:"10%"},children:"StockX価格"}),(0,a.jsx)("th",{style:{width:"10%"},children:"日本最安値"}),(0,a.jsx)("th",{style:{width:"10%"},children:"差額"}),(0,a.jsx)("th",{style:{width:"20%"},children:"経費内訳"}),(0,a.jsx)("th",{style:{width:"10%"},children:"予想利益"}),(0,a.jsx)("th",{style:{width:"8%"},children:"人気度"}),(0,a.jsx)("th",{style:{width:"7%"},children:"操作"})]})}),(0,a.jsx)("tbody",{children:0===t.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"8",className:"text-center py-8 text-gray-500",children:"条件に一致する商品が見つかりませんでした"})}):t.map(e=>(0,a.jsx)(n,{product:e},"".concat(e.id,"-").concat(e.size_id)))})]})})]})}function d(){let[e,s]=(0,l.useState)({brand:"all",category:"all",minProfit:1e3,size:"all",popularOnly:!0,inStockOnly:!1}),[t,n]=(0,l.useState)(null),[d,h]=(0,l.useState)(!0),u=async()=>{try{let e=await fetch("/api/stats"),s=await e.json();s.lastScrapeTime&&s.lastScrapeTime!==t&&(console.log("新しいスクレイピングデータを検出、ページをリロードします"),n(s.lastScrapeTime),d&&setTimeout(()=>{window.location.reload()},2e3))}catch(e){console.error("スクレイピング状況の確認エラー:",e)}};return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/stats"),s=await e.json();n(s.lastScrapeTime)}catch(e){console.error("初期スクレイピング状況の取得エラー:",e)}})()},[]),(0,l.useEffect)(()=>{if(!d)return;let e=setInterval(u,3e4);return()=>clearInterval(e)},[t,d]),(0,a.jsxs)("main",{children:[(0,a.jsx)(i,{}),(0,a.jsx)(c,{}),(0,a.jsx)(r,{onFilterChange:e=>{s(e)},onRefresh:()=>{window.location.reload()},isAutoRefreshEnabled:d,onToggleAutoRefresh:()=>{h(!d)},lastScrapeTime:t}),(0,a.jsx)(o,{filters:e})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4016)}),_N_E=e.O()}]);